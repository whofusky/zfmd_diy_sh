
# mvHtfileToSftp.sh说明

</br>

> 将merge_windtower_htfile脚本生成的结果文件(文件名类似:    
> cft_001_010_20230307-20230307.csv 其中20230307表示日期),  
> 非当天的数据移动到sftp上传文件夹  

</br>

软件当前版本: v20.01.000

文档更新时间: 2023-04-24

作者    : fu.sky

</br>

------------------------------

版本变化历史记录:

>
> 2023-04-24 : 初始版本 : v20.01.000
>

------------------------------

</br>


## 目录

+ 1. -------------------------[软件部署](#软件部署)
+ 2. -------------------------[软件目录结构说明](#软件目录结构说明)

</br>

------------------------------

</br>



## 软件部署

### 1.确定要生成的文件所属操作系统用户

比如要生成的文件是在zfmd用户的软件在使用则此文件操作系统用户属主为zfmd

### 2. 用第1步确定的操作系统用户登录服务器

### 3. 将mv_htfile_to_sftp压缩包导入服务器

### 4. 确定mv_htfile_to_sftp放于系统哪个目录

比如常用的软件部署目录是 `/zfmd/` 则将mv_htfile_to_sftp压缩包解压后
的文件夹mv_htfile_to_sftp放于 `/zfmd/`目录下

### 5. 在部署的目录mv_htfile_to_sftp下打开mvHtfileToSftp.sh文件

将脚本的如下部分进行修改或添加设置:

```shell
#--------------------------------------------------
#
#        配置要拷贝的源目录与目标目录
#
#--------------------------------------------------
g_src_dir[0]="/zfmd/data_file/CFT_DST"
g_src_file[0]="*.csv"
g_dst_dir[0]="/zfmd/data_file/CFT_UP"


```

1. g_src_dir为需要监视的源文件夹(也是merge_windtower_htfile脚本生成的结果目录)
2. g_src_file为源文件夹需要监视的文件类型
3. g_dst_dir为需要把源文件移动到的目标目录(也是sftp上传程序的源目录)
4. 可以配置多组配置,不同组通过下标[]区分；下标须从0开始且连续

</br>

### 6. 将mergeWtHtFile.sh脚本加入自启动中

将mergeWtHtFile.sh加入自启动中有两种方法:

方法1: 将脚本mergeWtHtFile.sh.sh加入系统的crontab中;    
方法2: 将脚本mergeWtHtFile.sh加入自启动软件中,但前提是系统中已经部署了自启动软件.

推荐使用第2种方法

假定系统的自启动软件部署在`/zfmd/startup`下,则打开自启动的的配置文件(配置zfmd用户下的软件自启动打开 rcfgRoot.cfg文件,其他用户下的软件自启动打开 rcfg.cfg文件)
添加如下配置项:

```

[mvHtfileToSftp.sh]                 
logDir=/zfmd/mv_htfile_to_sftp/ttylog
runPath=/zfmd/mv_htfile_to_sftp
runPrePara=
runPara=

```

</br>


### 7. 检查mvHtfileToSftp.sh的日志是否有报错及其他情况

> 需要通过命令 `pidof -x mvHtfileToSftp.sh` 查看是否有进程在运行(有进程号输出则表示有进程在运行)    
>> (1) 如果没有进程号则需要排查自启动是否生效，或者脚本重启后自己退出了?    
>> (2) 如果程序自己异常退出则需要通过查看日志文件错误信息排除错误    

当确认程序进程在运行中后,查看日志文件(当天的日志)是否有ERROR      
(1) 有ERROR 则需要提示信息修改相应部署或配置，直至无ERRR生成    
(2) 没有ERROR时检源文件是否有符合要求的需要移动的文件,如果有是否正常移动到目标目录。     
(3) 一切检查都正常后,确认loglevel文件的日志级别需要是INFO,以免产生不必要的日志


</br>

------------------------------

</br>

## 软件目录结构说明

</br>

软件所在目录的结构和相关说明如下：


```
mv_htfile_to_sftp/
├── log/                              #日志目录脚本会自动删除10天之前的日志
│   └── mvHtfileToSftp_20230424.log
│
├── loglevel                          #日志控制文件,可以在不重启脚本的
│                                     #    情况下修改此文件来控制日志
│                                     #    文件显示不同的日志内容
│
├── mvHtfileToSftp.sh*                #主逻辑脚本
├── readme.md*                        #markdown格式说明文档
└── version.txt                       #脚本软件记录文件


```

</br>

 [返回目录](#目录)

</br>

------------------------------------------------------------------------------

