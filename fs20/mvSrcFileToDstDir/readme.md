
# mvSrcFileToDstDir说明

软件（脚本）功能: 
>实时监视某个（或某几个）特指定目录下的符合要求的文件名（支持通
配符配置），如果有符合要求的文件则移动到目标目录

软件版本: v20.01.010

日期: 2021-04-02

------------------------------

## 1.软件目录结构说明

软件所在目录的结构和相关说明如下：


```
mvSrcFileToDstDir/                         #-----脚本所在包（目录）名
├── cfg                                    #-----配置文件所在目录
│   └── cfg.cfg                                 #-----配置文件
├── log                                    #-----脚本日志目录
│   ├── cron.log                                #-----脚本crontab重定向日志
│   └── mvSrcFileToDstDir_20210327.log          #-----脚本输入日志文件
├── mvSrcFileToDstDir.sh                   #-----主脚本文件
├── myDiyShFunction.sh                     #-----脚本用到的函数文件
├── readme.md                              #-----markdonw格式的说明文件
└── tmp                                    #-----临时目录（暂无用处)

```


------------------------------

## 2.功能详细说明

1.  程序核心功能就是**监视文件，有符合要求的文件则把文件移动到对应的目标目录**，
具体详细的功能需要打开cfg/cfg.cfg配置文件并仔细阅读配置文件中的注释说明接合
自己的需求进行正确地配置来实现。

2.  支持对多个不同的源目录进行监视。

3.  支持对同一个源目录配合多个不同的目标目录（即同一个源目录中的文件可以分发
到多个目标目录）

4.  同一个源目录的监视的文件名可以配置多个类型的文件，每一个类型的文件名支持
具体的文件名，也支持有通配符的文件名配置（通配符配置规则与bash中支持的一至）。

5.  支持当**源文件生成完毕才移动**文件的功能，此功能是通过监视文件的修改时间
变化频率来实现的，时间长短在配置文件中可以配置，同一个源目录共用一个时间配置，
如果有不 同的时间需求，可以分成多个源目录进行配置。

 > 例如:    
 >  配置文件中配置的g_basicCondition_secw值为5则表示当对应源文件的修改时间在5秒
 >内没有发生变动，则认定此文件可以进行移动了，反之则表示此文件还在进行生成过程
 >中(没生成完毕)不对其进行移动

6.  建议脚本通过crontab定时启动，定时是防止软件不正常退出时可以被定时服务自动
启动。而软件本身是长驻内存的。软件本身有防止软件重复启动的功能，即当前如果程序
已经启动，则再次启动程序时，程序会正常退出本次的程序，只保留一个程序在运行。

7.  脚本启动后，正常运行中，如果修改对应的配置文件，只要保存配置文件即可。脚本
会自动加载新的配置文件生效（即**配置文件的修改是实时生效的不需要重启脚本**）。


------------------------------

## 3.软件部署

1. 确定软件部署的用户
>确定需要移动的文件属于哪个用户或者目标文件需要在什么用户下进行操作则此软件件运行在哪个操作系统用户下

2. 需要确认部署的用户对源目录和目标目录有写的权限（即软件需要有移动源文件到目标目录的权限)

3. 将此软件包解压后（解压请在linux下进行）放在与公司常用软件目录；例如放在/zfmd/wpfs20目录下

3. 在软件包下找到配置文件cfg/cfg.cfg，根据实际情况和配置文件注释说明进行配置
> 注意:    
> 1. 修改文件配置时需要仔细阅读配置文件中每一个配置项对应的注释说明，然后接合现场的实际需求进行配置
> 2. 配置文件中各配置项名称不能变（修改配置文件前把配置文件备份一下)
> 3. 调试时g_debugL_value的值设置成最大，比如49, 以输出全量日志,方便调试。

4. 在配置文件中的源目录放一些**符合要求的测试文件**，以便后面测试用。

5. 在软件包目录下打开终端执行 `chmod u+x *.sh` 并用命令`./mvSrcFileToDstDir.sh`
   手动运行程序，查看配置文件中源目录的文件是否正常移动到目标目录

6. 查看log目录下日志文件是否有ERROR字样的报错信息

7. 在第5，6步确认正常后将手动启动的那个终端用`Ctl + c`退出程序，将此软件配置到
crontab定时任务中去(假定程序部署后的目录为:/zfmd/wpfs20/mvSrcFileToDstDir/)
> 执行`crontab -e`命令，在打开的界面最后添加如下配置项
>
>`* * * * * /zfmd/wpfs20/mvSrcFileToDstDir/mvSrcFileToDstDir.sh >>/zfmd/wpfs20/mvSrcFileToDstDir/log/cron.log 2>&1`
>
>注:上面的配置应该在同一行上

8. 将配置文件中的日志级别修改为g_debugL_value=1

9. 在源目录放置一些**符合要求的测试文件**,观察是否能正常移动到目标目录

10. 部署结束.  

------------------------------


## 5.其他需要说明的情况

1. 配置文件中有配置过期则把相应过期文件删除的配置项，即使是配置成删除且有符合条件的文件需要删除，
程序不是立即执行删除，当前系统时间对应分钟数在15到25之间才执行删除操作（有此条件是以量避免影响程序的正常功能)


